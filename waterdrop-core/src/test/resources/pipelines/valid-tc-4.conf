spark {
  # You can set spark configuration here
  # Waterdrop defined streaming batch duration in seconds
  spark.streaming.batchDuration = 5

  # see available properties defined by spark: https://spark.apache.org/docs/latest/configuration.html#available-properties
  spark.app.name = "Waterdrop"
  spark.executor.instances = 2
  spark.executor.cores = 1
  spark.executor.memory = "1g"
}

pipeline<p1> {
  input {
    fileStream {
      path = "/tmp/waterdrop/stream1"
    }
  }

  filter {
    sql {
      table_name = "t1"
      sql = "select * from t1 where raw_message <> 'k1,3'"
    }
  }
  output {
    stdout {}
  }
}

pipeline<p2> {
  input {
    fileStream {
      path = "/tmp/waterdrop/stream2"
    }
  }

  filter {
    split {
      delimiter = ","
      fields = ["key", "value"]
    }
  }
  output {
    stdout {}
  }
}


